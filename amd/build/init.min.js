define("block_accessibility_filescan/init",["exports","jquery","core/notification","core/templates","core/chartjs","core/modal_factory","./util"],(function(_exports,_jquery,_notification,_templates,_chartjs,_modal_factory,_util){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_templates=_interopRequireDefault(_templates),_chartjs=_interopRequireDefault(_chartjs),_modal_factory=_interopRequireDefault(_modal_factory);_exports.init=(data,courseid)=>{function getLastScanned(){const max=[].concat(data.pdfs.pass,data.pdfs.warn,data.pdfs.fail).reduce(((a,b)=>+a.lastchecked>+b.lastchecked?a:b));if(max){const date=new Date(1e3*+max.lastchecked);return"Last scanned ".concat(date.toDateString()," at ").concat(date.toLocaleTimeString())}return""}async function createModal(){const $table=function(){const $table=(0,_jquery.default)("<table/>").attr("id","block-accessibility-filescan-table").addClass("table table-bordered table-hover w-100").append((0,_jquery.default)("<thead/>").addClass("w-100").append((0,_jquery.default)("<tr/>").addClass("w-100").append((0,_jquery.default)("<th/>").attr("scope","col").text("Filename")).append((0,_jquery.default)("<th/>").attr("scope","col").text("Lang")).append((0,_jquery.default)("<th/>").attr("scope","col").text("Text")).append((0,_jquery.default)("<th/>").attr("scope","col").text("Title")).append((0,_jquery.default)("<th/>").attr("scope","col").text("Tagged")).append((0,_jquery.default)("<th/>").attr("scope","col").text("Pages")))),$tableBody=(0,_jquery.default)("<tbody/>"),$tableRows=[].concat(data.pdfs.pass,data.pdfs.warn,data.pdfs.fail).map((pdf=>(0,_jquery.default)("<tr/>").addClass("w-100").append((0,_jquery.default)("<td/>").addClass("text-truncate").append((0,_jquery.default)("<a/>").attr("href",pdf.url).text(pdf.filename))).append((0,_jquery.default)("<td/>").append("1"===pdf.haslanguage?(0,_jquery.default)((0,_util.renderSuccessIcon)()):(0,_jquery.default)((0,_util.renderFailIcon)()))).append((0,_jquery.default)("<td/>").append("1"===pdf.hastext?(0,_jquery.default)((0,_util.renderSuccessIcon)()):(0,_jquery.default)((0,_util.renderFailIcon)()))).append((0,_jquery.default)("<td/>").append("1"===pdf.hastitle?(0,_jquery.default)((0,_util.renderSuccessIcon)()):(0,_jquery.default)((0,_util.renderFailIcon)()))).append((0,_jquery.default)("<td/>").append("1"===pdf.istagged?(0,_jquery.default)((0,_util.renderSuccessIcon)()):(0,_jquery.default)((0,_util.renderFailIcon)()))).append((0,_jquery.default)("<td/>").append(pdf.pagecount>=1?(0,_jquery.default)("<span/>").text(pdf.pagecount):(0,_jquery.default)((0,_util.renderFailIcon)())))));return $tableBody.append($tableRows),$table.append($tableBody),$table}(),$modalBody=(0,_jquery.default)("<div/>").append((0,_jquery.default)("<button/>").addClass("btn btn-secondary mb-2").text("Download to CSV").click((()=>(0,_util.download_table_as_csv)("block-accessibility-filescan-table")))).append((0,_jquery.default)("<div/>").addClass("table-responsive")).append($table),modal=await _modal_factory.default.create({title:"Accessibility of Course PDFs - Details",body:$modalBody,footer:(0,_jquery.default)("<p/>").text(getLastScanned()),large:!0});return modal.getRoot()[0].childNodes[1].style.maxWidth="95vw",modal}_templates.default.renderForPromise("block_accessibility_filescan/summary",{name:"A11y Check"}).then((_ref=>{let{html:html,js:js}=_ref;_templates.default.appendNodeContents("#block-accessibility-filescan-root",html,js),createModal().then((modal=>{data.pdfs.pass.length>0||data.pdfs.warn.length>0||data.pdfs.fail.length>0?(!function(){const canvas=(0,_jquery.default)("<canvas/>").attr({id:"#block-accessibility-filescan-pie-chart-canvas","aria-label":"Pie chart describing the accessibility status of this course's PDFs."}),ctx=canvas[0].getContext("2d");(0,_jquery.default)("#block-accessibility-filescan-pie-chart-root").addClass("mb-2 w-100").append((0,_jquery.default)("<h6/>").addClass("mb-2").text("Accessibility of Course PDFs")).append(canvas);const chartData={labels:["Satisfies all checks (".concat(data.pdfs.pass.length,")"),"Satisfies some checks (".concat(data.pdfs.warn.length,")"),"Satisfies no checks (".concat(data.pdfs.fail.length,")")],datasets:[{label:"PDFs",data:[data.pdfs.pass.length,data.pdfs.warn.length,data.pdfs.fail.length],backgroundColor:["#198754","#f0ad4e","#d9534f"]}]};new _chartjs.default(ctx,{type:"pie",data:chartData})}(),(0,_jquery.default)("#block-accessibility-filescan-more-details-root").addClass("mb-2").append(function(modal){return(0,_jquery.default)("<button/>").addClass("btn btn-secondary").text("Details").click((()=>{modal.show()}))}(modal)).append((0,_jquery.default)("<p/>").addClass("mt-3").append((0,_jquery.default)("<small/>").text(getLastScanned())))):(0,_jquery.default)("#block-accessibility-filescan-root").append((0,_jquery.default)("<p/>").text("No data to show ðŸ˜¢"))})).catch((error=>(0,_notification.exception)(error)))})).catch((error=>(0,_notification.exception)(error)))}}));

//# sourceMappingURL=init.min.js.map